<!DOCTYPE html>
<html>
<head>
  <title>Clicker with Aura UPDATE</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: linear-gradient(to bottom right, #e0f7ff, #f0fff4);
      padding: 20px;
    }
    button {
      font-size: 18px;
      padding: 10px 20px;
      margin: 8px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      color: white;
      user-select: none;
    }
    #diamond-button { background-color: #00bfff; }
    #gold-button { background-color: #daa520; }
    #emerald-button { background-color: #50c878; }
    #buy-gold-button { background-color: #28a745; }
    #buy-emerald-button { background-color: #2e8b57; }
    .upgrade-button { background-color: #6f42c1; }
    #roll-aura-button { background-color: #ff1493; }
    .equip-button { background-color: #555; }

    #counters { font-size: 26px; margin: 10px 0; }
    #text-container { margin-top: 15px; font-size: 20px; color: #555; min-height: 30px; }
    #aura-section { margin-top: 30px; background: #fff; padding: 20px; border-radius: 15px; box-shadow: 0 0 15px rgba(0,0,0,0.1); }

    #rank-button {
      position: fixed;
      top: 15px;
      left: 15px;
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      z-index: 150;
      font-size: 14px;
      user-select: none;
    }
    #rank-panel {
      position: fixed;
      top: 60px;
      left: 15px;
      background: rgba(0,0,0,0.85);
      color: white;
      padding: 10px;
      border-radius: 8px;
      display: none;
      z-index: 150;
      max-height: 320px;
      overflow-y: auto;
      font-size: 14px;
      min-width: 160px;
    }
    #rank-panel h3 {
      margin: 0 0 6px 0;
      font-size: 16px;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>ðŸ’Ž Gold & Emerald Clicker + AURA SYSTEM ðŸŒŒ</h1>
  <div id="playerName"></div>

  <div id="counters">
    Diamonds: <span id="diamond-count">0</span><br>
    Gold: <span id="gold-count">0</span><br>
    Emeralds: <span id="emerald-count">0</span>
  </div>

  <button id="diamond-button">Click ðŸ’Ž</button>
  <button id="gold-button" disabled>Click ðŸª™</button>
  <button id="emerald-button" disabled>Click ðŸ’š</button>

  <br>
  <button id="buy-gold-button">Buy Gold for 100 Diamonds</button>
  <button id="buy-emerald-button">Buy Emerald for 1000 Diamonds & 700 Gold</button>

  <hr>

  <h2>ðŸ”¼ Upgrades</h2>
  <button class="upgrade-button" id="upgrade-diamond">Upgrade Diamond (Cost: 500,000 ðŸ’Ž)</button>
  <div>Diamond Upgrade Level: <span id="diamond-upgrade-level">0</span></div>

  <button class="upgrade-button" id="upgrade-gold" disabled>Upgrade Gold (Cost: 10,000,000 ðŸª™)</button>
  <div>Gold Upgrade Level: <span id="gold-upgrade-level">0</span></div>

  <button class="upgrade-button" id="upgrade-emerald" disabled>Upgrade Emerald (Cost: 30,000,000 ðŸ’š)</button>
  <div>Emerald Upgrade Level: <span id="emerald-upgrade-level">0</span></div>

  <div id="aura-section">
    <h2>ðŸŒ  Aura System</h2>
    <button id="roll-aura-button">ðŸŽ² Roll Aura (Cost: 20,000 ðŸ’š)</button>
    <div id="aura-result"></div>
    <h3>Owned Auras:</h3>
    <div id="owned-auras"></div>
    <h3>Equipped Aura: <span id="equipped-aura">None</span></h3>
  </div>

  <div id="text-container"></div>

  <div id="rank-button">Ranks (Online)</div>
  <div id="rank-panel"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, collection, query, orderBy, limit, getDocs, updateDoc }
      from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
    import { getAuth, signInAnonymously, onAuthStateChanged }
      from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAeS3jgX2iatIkI_jrCqW7bfyjXuF-QvmI",
      authDomain: "clickercoin.firebaseapp.com",
      projectId: "clickercoin",
      storageBucket: "clickercoin.firebasestorage.app",
      messagingSenderId: "1084556702855",
      appId: "1:1084556702855:web:62ab02d23498f167d43422"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let currentUser = null;
    signInAnonymously(auth);
    onAuthStateChanged(auth, user => currentUser = user);

    // Player setup
    let playerName = localStorage.getItem("playerName");
    while (!playerName || playerName.trim() === "") {
      playerName = prompt("Enter your name:");
    }
    localStorage.setItem("playerName", playerName);
    document.getElementById("playerName").textContent = `ðŸ‘¤ Player: ${playerName}`;

    // Variables
    let diamonds = parseInt(localStorage.getItem("diamondCount") || "0");
    let gold = parseInt(localStorage.getItem("goldCount") || "0");
    let emeralds = parseInt(localStorage.getItem("emeraldCount") || "0");
    let diamondUpgradeLevel = parseInt(localStorage.getItem("diamondUpgradeLevel") || "0");
    let goldUpgradeLevel = parseInt(localStorage.getItem("goldUpgradeLevel") || "0");
    let emeraldUpgradeLevel = parseInt(localStorage.getItem("emeraldUpgradeLevel") || "0");
    let ownedAuras = JSON.parse(localStorage.getItem("ownedAuras") || "[]");
    let equippedAura = localStorage.getItem("equippedAura") || "None";

    const auraList = [
      { name: "Common", rate: 49.9, bonus: { diamond:15, gold:20, emerald:25 }},
      { name: "Uncommon", rate: 29.9, bonus: { diamond:20, gold:25, emerald:35 }},
      { name: "Rare", rate: 24.9, bonus: { diamond:50, gold:55, emerald:60 }},
      { name: "Epic", rate: 20.9, bonus: { diamond:65, gold:68, emerald:73 }},
      { name: "Legendary", rate: 18.9, bonus: { diamond:15000, gold:20000, emerald:25000 }},
      { name: "Powered", rate: 14.9, bonus: { diamond:30000, gold:45000, emerald:54000 }},
      { name: "Starlight", rate: 10.9, bonus: { diamond:80000, gold:86000, emerald:92000 }},
      { name: "Exotic", rate: 7.9, bonus: { diamond:129000, gold:450000, emerald:110000 }},
      { name: "Celestial-Divine", rate: 4.9, bonus: { diamond:15000000, gold:2000000, emerald:20000000 }},
      { name: "Abyssal Hunter", rate: 1.0, bonus: { diamond:50000000, gold:55000000, emerald:55000000 }}
    ];

    function getAuraBonus() {
      const aura = auraList.find(a => a.name === equippedAura);
      return aura ? aura.bonus : { diamond:0, gold:0, emerald:0 };
    }

    // Clicks
    function addDiamond() { const b=getAuraBonus(); diamonds += (1+b.diamond); save(); updateDisplay(); saveHighScore(); }
    function addGold() { if (gold>0){const b=getAuraBonus(); gold += (1+b.gold); save(); updateDisplay();} else showMsg("You need to unlock gold!"); }
    function addEmerald() { if (emeralds>0){const b=getAuraBonus(); emeralds += (1+b.emerald); save(); updateDisplay();} else showMsg("You need to unlock emerald!"); }

    // Buy unlocks
    function buyGold() {
      if (diamonds >= 100 && gold === 0) {
        diamonds -= 100; gold = 1;
        showMsg("Gold unlocked!");
      } else showMsg("Not enough diamonds!");
      save(); updateDisplay();
    }

    function buyEmerald() {
      if (diamonds >= 1000 && gold >= 700 && emeralds === 0) {
        diamonds -= 1000; gold -= 700; emeralds = 1;
        showMsg("Emerald unlocked!");
      } else showMsg("Need more ðŸ’Ž or ðŸª™!");
      save(); updateDisplay();
    }

    function rollAura() {
      if (emeralds < 20000) return showMsg("Not enough Emeralds!");
      emeralds -= 20000;
      const aura = getAuraByChance();
      if (!ownedAuras.includes(aura.name)) ownedAuras.push(aura.name);
      showMsg(`ðŸŽ† You got ${aura.name} Aura!`);
      save(); renderOwnedAuras(); updateDisplay();
    }

    function getAuraByChance() {
      const rand = Math.random() * 100; let sum = 0;
      for (let aura of auraList) { sum += aura.rate; if (rand <= sum) return aura; }
      return auraList[0];
    }

    function equipAura(name) { equippedAura = name; save(); updateDisplay(); showMsg(`âœ¨ Equipped ${name}!`); }

    function save() {
      localStorage.setItem("diamondCount", diamonds);
      localStorage.setItem("goldCount", gold);
      localStorage.setItem("emeraldCount", emeralds);
      localStorage.setItem("ownedAuras", JSON.stringify(ownedAuras));
      localStorage.setItem("equippedAura", equippedAura);
      localStorage.setItem("diamondUpgradeLevel", diamondUpgradeLevel);
      localStorage.setItem("goldUpgradeLevel", goldUpgradeLevel);
      localStorage.setItem("emeraldUpgradeLevel", emeraldUpgradeLevel);
    }

    function updateDisplay() {
      document.getElementById("diamond-count").innerText = diamonds.toLocaleString();
      document.getElementById("gold-count").innerText = gold.toLocaleString();
      document.getElementById("emerald-count").innerText = emeralds.toLocaleString();
      document.getElementById("equipped-aura").innerText = equippedAura;
      document.getElementById("gold-button").disabled = gold <= 0;
      document.getElementById("emerald-button").disabled = emeralds <= 0;
      document.getElementById("upgrade-gold").disabled = gold <= 0;
      document.getElementById("upgrade-emerald").disabled = emeralds <= 0;
    }

    function renderOwnedAuras() {
      const div = document.getElementById("owned-auras");
      div.innerHTML = "";
      ownedAuras.forEach(aura => {
        const btn = document.createElement("button");
        btn.className = "equip-button";
        btn.innerText = aura + " (Equip)";
        btn.onclick = () => equipAura(aura);
        div.appendChild(btn);
      });
    }

    function showMsg(msg) { const el = document.getElementById("text-container"); el.innerText = msg; setTimeout(() => el.innerText = "", 2000); }

    document.getElementById("diamond-button").onclick = addDiamond;
    document.getElementById("gold-button").onclick = addGold;
    document.getElementById("emerald-button").onclick = addEmerald;
    document.getElementById("buy-gold-button").onclick = buyGold;
    document.getElementById("buy-emerald-button").onclick = buyEmerald;
    document.getElementById("roll-aura-button").onclick = rollAura;

    renderOwnedAuras(); updateDisplay();

    // Firebase leaderboard
    async function saveHighScore() {
      if (!currentUser) return;
      const ref = doc(db, "auraScores", currentUser.uid);
      const snap = await getDoc(ref);
      if (!snap.exists()) await setDoc(ref, { name: playerName, diamonds });
      else if (diamonds > (snap.data().diamonds || 0)) await updateDoc(ref, { name: playerName, diamonds });
    }

    const rankButton = document.getElementById("rank-button");
    const rankPanel = document.getElementById("rank-panel");
    let rankRefreshInterval = null;

    async function fetchLeaderboard() {
      const q = query(collection(db, "auraScores"), orderBy("diamonds", "desc"), limit(30));
      const snap = await getDocs(q);
      return snap.docs.map((doc, i) => {
        const data = doc.data();
        return `${i + 1}. ${data.name || "Anon"} â€” ${data.diamonds.toLocaleString()} ðŸ’Ž`;
      });
    }

    rankButton.addEventListener("click", async () => {
      if (rankPanel.style.display === "block") {
        rankPanel.style.display = "none";
        clearInterval(rankRefreshInterval);
        return;
      }
      rankPanel.style.display = "block";
      rankPanel.innerHTML = "<h3>Ranks (Online)</h3><div>Loadingâ€¦</div>";
      async function refreshRanks() {
        const list = await fetchLeaderboard();
        const time = new Date().toLocaleTimeString();
        const myRank = list.findIndex(line => line.includes(playerName));
        const rankText = myRank >= 0 ? `<br><b>ðŸ‘‘ Your Rank: #${myRank + 1}</b>` : "";
        rankPanel.innerHTML = `<h3>Ranks (Online)</h3>${list.join("<br>")}${rankText}<br><br><small>Updated: ${time}</small>`;
      }
      await refreshRanks();
      rankRefreshInterval = setInterval(refreshRanks, 10000);
    });
  </script>
</body>
</html>
