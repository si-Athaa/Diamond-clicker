<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ðŸ’Ž Diamond, Gold & Emerald Clicker + Ranks</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: linear-gradient(135deg, #d7ecff, #f5ffff);
      padding: 20px;
    }
    h1 { margin-bottom: 10px; }

    button {
      font-size: 18px;
      padding: 10px 22px;
      margin: 8px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      color: white;
      user-select: none;
    }

    #diamond-button { background-color: #00bfff; }
    #diamond-button:hover { background-color: #1e90ff; }

    #gold-button { background-color: #daa520; }
    #gold-button:hover { background-color: #b8860b; }

    #emerald-button { background-color: #50c878; }
    #emerald-button:hover { background-color: #3aa655; }

    #buy-gold-button, #upgrade-diamond, #upgrade-gold, #upgrade-emerald { background-color: #28a745; }
    #buy-gold-button:hover, #upgrade-diamond:hover, #upgrade-gold:hover, #upgrade-emerald:hover { background-color: #218838; }

    #buy-emerald-button {
      background-color: #2e8b57;
    }
    #buy-emerald-button:hover {
      background-color: #1e5f3a;
    }

    #counters { font-size: 26px; margin: 10px 0; }
    .cps-display { font-size: 16px; margin-bottom: 10px; color: #444; }
    #text-container { margin-top: 20px; height: 30px; font-size: 22px; color: #333; }

    /* Rank UI */
    #rank-button {
      position: fixed;
      top: 15px;
      left: 15px;
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      z-index: 150;
      font-size: 14px;
      user-select: none;
    }

    #rank-panel {
      position: fixed;
      top: 60px;
      left: 15px;
      background: rgba(0,0,0,0.85);
      color: white;
      padding: 10px;
      border-radius: 8px;
      display: none;
      z-index: 150;
      max-height: 320px;
      overflow-y: auto;
      font-size: 14px;
      min-width: 160px;
    }

    #rank-panel h3 {
      margin: 0 0 6px 0;
      font-size: 16px;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>ðŸ’Ž Diamond, Gold & Emerald Clicker</h1>

  <div id="playerName"></div>

  <div id="counters">
    Diamonds: <span id="diamond-count">0</span><br>
    Gold: <span id="gold-count">0</span><br>
    Emeralds: <span id="emerald-count">0</span>
  </div>

  <button id="diamond-button">Click ðŸ’Ž</button>
  <div class="cps-display" id="diamond-cps">Diamond CPS: L:0 | R:0</div>

  <button id="gold-button" disabled>Click ðŸª™</button>
  <div class="cps-display" id="gold-cps">Gold CPS: L:0 | R:0</div>

  <button id="emerald-button" disabled>Click ðŸ’š</button>
  <div class="cps-display" id="emerald-cps">Emerald CPS: L:0 | R:0</div>

  <br>
  <button id="buy-gold-button">Buy Gold (100 ðŸ’Ž)</button>
  <button id="buy-emerald-button">Buy Emerald (1000 ðŸ’Ž + 700 ðŸª™)</button>

  <br><hr><br>
  <h2>ðŸ”¼ Upgrades</h2>
  <button id="upgrade-diamond">Upgrade Diamond (Cost: 500,000 ðŸ’Ž)</button><br>
  <button id="upgrade-gold" disabled>Upgrade Gold (Cost: 10,000,000 ðŸª™)</button><br>
  <button id="upgrade-emerald" disabled>Upgrade Emerald (Cost: 5 ðŸ’š)</button>

  <div id="text-container"></div>

  <div id="rank-button">Ranks (Online)</div>
  <div id="rank-panel"></div>

  <script type="module">
    /* ---------- Firebase Setup ---------- */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, collection, query, orderBy, limit, getDocs, updateDoc } 
      from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } 
      from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

    const firebaseConfig = {
    apiKey: "AIzaSyB7c4UCU7qpVecl5JM-wRSMnqFz9DCjdlA",
    authDomain: "diamondclicker-b3a0a.firebaseapp.com",
    projectId: "diamondclicker-b3a0a",
    storageBucket: "diamondclicker-b3a0a.firebasestorage.app",
    messagingSenderId: "334913006559",
    appId: "1:334913006559:web:f1b73789e56c61d4a8b26a"
  };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let currentUser = null;
    signInAnonymously(auth);
    onAuthStateChanged(auth, user => {
      currentUser = user;
      console.log("Signed in as", user.uid);
    });

    /* ---------- Player Setup ---------- */
    let playerName = localStorage.getItem("playerName");
    while (!playerName || playerName.trim() === "") {
      playerName = prompt("Masukkan nama kamu (tidak boleh kosong):");
    }
    localStorage.setItem("playerName", playerName);
    document.getElementById("playerName").textContent = `ðŸ‘¤ Player: ${playerName}`;

    /* ---------- Game Variables ---------- */
    let diamonds = 0, gold = 0, emeralds = 0;
    let diamondUpgradeLevel = 0, goldUpgradeLevel = 0, emeraldUpgradeLevel = 0;
    let diamondPerClick = 1, goldPerClick = 1, emeraldPerClick = 1;
    let diamondUpgradeCost = 500000, goldUpgradeCost = 10000000, emeraldUpgradeCost = 5;
    const cps = { diamond:{left:0,right:0}, gold:{left:0,right:0}, emerald:{left:0,right:0} };

    /* ---------- Load Saved Progress ---------- */
    if(localStorage.getItem("diamondCount")) diamonds = parseInt(localStorage.getItem("diamondCount"));
    if(localStorage.getItem("goldCount")) gold = parseInt(localStorage.getItem("goldCount"));
    if(localStorage.getItem("emeraldCount")) emeralds = parseInt(localStorage.getItem("emeraldCount"));
    if(localStorage.getItem("diamondUpgradeLevel")) diamondUpgradeLevel = parseInt(localStorage.getItem("diamondUpgradeLevel"));
    if(localStorage.getItem("goldUpgradeLevel")) goldUpgradeLevel = parseInt(localStorage.getItem("goldUpgradeLevel"));
    if(localStorage.getItem("emeraldUpgradeLevel")) emeraldUpgradeLevel = parseInt(localStorage.getItem("emeraldUpgradeLevel"));

    updateStats();

    /* ---------- Button Setup ---------- */
    function setupClick(btnId, resName, func) {
      const btn = document.getElementById(btnId);
      btn.addEventListener('click', () => { func(); cps[resName].left++; });
      btn.addEventListener('contextmenu', e => { e.preventDefault(); func(); cps[resName].right++; });
    }

    setupClick('diamond-button', 'diamond', addDiamond);
    setupClick('gold-button', 'gold', addGold);
    setupClick('emerald-button', 'emerald', addEmerald);

    document.getElementById('buy-gold-button').addEventListener('click', buyGold);
    document.getElementById('buy-emerald-button').addEventListener('click', buyEmerald);
    document.getElementById('upgrade-diamond').addEventListener('click', upgradeDiamond);
    document.getElementById('upgrade-gold').addEventListener('click', upgradeGold);
    document.getElementById('upgrade-emerald').addEventListener('click', upgradeEmerald);

    /* ---------- Click Actions ---------- */
    function addDiamond() {
      diamonds += diamondPerClick;
      save(); updateStats();
      showMsg(`+${diamondPerClick} ðŸ’Ž`);
      saveHighScore();
    }
    function addGold() { if (gold>0){gold+=goldPerClick;save();updateStats();showMsg(`+${goldPerClick} ðŸª™`);} }
    function addEmerald(){if(emeralds>0){emeralds+=emeraldPerClick;save();updateStats();showMsg(`+${emeraldPerClick} ðŸ’š`);} }

    /* ---------- Buy Unlocks ---------- */
    function buyGold(){if(diamonds>=100&&gold===0){diamonds-=100;gold=1;showMsg("Gold unlocked!");}else showMsg("Not enough ðŸ’Ž!");save();updateStats();}
    function buyEmerald(){if(diamonds>=1000&&gold>=700){diamonds-=1000;gold-=700;emeralds++;showMsg("Emerald unlocked!");}else showMsg("Not enough resources!");save();updateStats();}

    /* ---------- Upgrades ---------- */
    function upgradeDiamond(){
      if(diamonds>=diamondUpgradeCost){
        diamonds-=diamondUpgradeCost;
        diamondUpgradeLevel++;
        diamondPerClick*=2;
        if(diamondUpgradeLevel===1)diamondPerClick+=2;
        diamondUpgradeCost*=5;
        showMsg(`Diamond upgraded Lv.${diamondUpgradeLevel}!`);
      } else showMsg("Not enough ðŸ’Ž!");
      save();updateStats();
    }

    function upgradeGold(){
      if(gold>=goldUpgradeCost){
        gold-=goldUpgradeCost;
        goldUpgradeLevel++;
        goldPerClick*=2;
        if(goldUpgradeLevel===1)goldPerClick+=4;
        goldUpgradeCost*=5;
        showMsg(`Gold upgraded Lv.${goldUpgradeLevel}!`);
      } else showMsg("Not enough ðŸª™!");
      save();updateStats();
    }

    function upgradeEmerald(){
      if(emeralds>=emeraldUpgradeCost){
        emeralds-=emeraldUpgradeCost;
        emeraldUpgradeLevel++;
        emeraldPerClick*=2;
        emeraldUpgradeCost*=5;
        showMsg(`Emerald upgraded Lv.${emeraldUpgradeLevel}!`);
      } else showMsg("Not enough ðŸ’š!");
      save();updateStats();
    }

    /* ---------- Save & UI ---------- */
    function save(){
      localStorage.setItem("diamondCount", diamonds);
      localStorage.setItem("goldCount", gold);
      localStorage.setItem("emeraldCount", emeralds);
      localStorage.setItem("diamondUpgradeLevel", diamondUpgradeLevel);
      localStorage.setItem("goldUpgradeLevel", goldUpgradeLevel);
      localStorage.setItem("emeraldUpgradeLevel", emeraldUpgradeLevel);
    }

    function updateStats(){
      document.getElementById("diamond-count").innerText = diamonds.toLocaleString();
      document.getElementById("gold-count").innerText = gold.toLocaleString();
      document.getElementById("emerald-count").innerText = emeralds.toLocaleString();

      document.getElementById("upgrade-diamond").innerText=`Upgrade Diamond (Lv ${diamondUpgradeLevel}) - Cost: ${diamondUpgradeCost.toLocaleString()} ðŸ’Ž`;
      document.getElementById("upgrade-gold").innerText=`Upgrade Gold (Lv ${goldUpgradeLevel}) - Cost: ${goldUpgradeCost.toLocaleString()} ðŸª™`;
      document.getElementById("upgrade-emerald").innerText=`Upgrade Emerald (Lv ${emeraldUpgradeLevel}) - Cost: ${emeraldUpgradeCost.toLocaleString()} ðŸ’š`;

      document.getElementById("gold-button").disabled=gold===0;
      document.getElementById("emerald-button").disabled=emeralds===0;
      document.getElementById("upgrade-gold").disabled=gold===0;
      document.getElementById("upgrade-emerald").disabled=emeralds===0;
    }

    function showMsg(text){
      const box=document.getElementById("text-container");
      box.innerText=text;
      setTimeout(()=>box.innerText="",1500);
    }

    setInterval(()=>{
      document.getElementById("diamond-cps").innerText=`Diamond CPS: L:${cps.diamond.left} | R:${cps.diamond.right}`;
      document.getElementById("gold-cps").innerText=`Gold CPS: L:${cps.gold.left} | R:${cps.gold.right}`;
      document.getElementById("emerald-cps").innerText=`Emerald CPS: L:${cps.emerald.left} | R:${cps.emerald.right}`;
      cps.diamond={left:0,right:0};cps.gold={left:0,right:0};cps.emerald={left:0,right:0};
    },1000);

    /* ---------- Firebase High Score ---------- */
    async function saveHighScore(){
      if(!currentUser)return;
      const ref=doc(db,"diamondScores",currentUser.uid);
      const snap=await getDoc(ref);
      if(!snap.exists()){
        await setDoc(ref,{name:playerName,diamonds});
      }else{
        const oldScore=snap.data().diamonds||0;
        if(diamonds>oldScore){
          await updateDoc(ref,{name:playerName,diamonds});
        }
      }
    }

    /* ---------- Rank Panel ---------- */
    const rankButton=document.getElementById("rank-button");
    const rankPanel=document.getElementById("rank-panel");
    let rankRefreshInterval=null;

    async function fetchLeaderboard(){
      const q=query(collection(db,"diamondScores"),orderBy("diamonds","desc"),limit(30));
      const snap=await getDocs(q);
      return snap.docs.map((doc,i)=>{
        const data=doc.data();
        return `${i+1}. ${data.name||"Anon"} â€” ${data.diamonds.toLocaleString()} ðŸ’Ž`;
      });
    }

    rankButton.addEventListener("click",async()=>{
      if(rankPanel.style.display==="block"){
        rankPanel.style.display="none";
        clearInterval(rankRefreshInterval);
        return;
      }
      rankPanel.style.display="block";
      rankPanel.innerHTML="<h3>Ranks (Online)</h3><div>Loadingâ€¦</div>";

      async function refreshRanks(){
        const list=await fetchLeaderboard();
        const time=new Date().toLocaleTimeString();
        const myRank=list.findIndex(line=>line.includes(playerName));
        const rankText=myRank>=0?`<br><b>ðŸ‘‘ Your Rank: #${myRank+1}</b>`:"";
        rankPanel.innerHTML=`<h3>Ranks (Online)</h3>${list.join("<br>")}${rankText}<br><br><small>Last updated: ${time}</small>`;
      }

      await refreshRanks();
      rankRefreshInterval=setInterval(refreshRanks,10000);
    });
  </script>
</body>
</html>
